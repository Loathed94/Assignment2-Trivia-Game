import{c as N,r as B,o as m,a as $,u as b,b as p,d as _,e as a,w as T,v as M,t as y,f as k,F as w,g as I,h as x,i as C,j as O,k as E,l as q,m as G,n as F,p as A,q as Q,s as P,x as D}from"./vendor.bfe0a0fd.js";const V=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}};V();const L="https://lechan-noroff-api.herokuapp.com",H="n1ZKh0vT2oxeCvrWBefmxhBLDpFw0bouiHRtG1OjzIgol1Lm2TWdWSIcD4kj8Zic",S="https://opentdb.com";async function J(){try{return[(await(await fetch(`${S}/api_category.php`)).json()).trivia_categories,null]}catch(s){return[[],s.message]}}async function j(s,t,e,o){try{let n;o===null?n=await fetch(`${S}/api.php?amount=${t}&category=${s}&difficulty=${e}`):n=await fetch(`${S}/api.php?amount=${t}&category=${s}&difficulty=${e}&token=${o}`);const r=await n.json();return[r.response_code,r.results]}catch(n){return[[],n.message]}}async function K(){try{let s=1,t="";for(;s!==0;){const o=await(await fetch(`${S}/api_token.php?command=request`)).json();s=o.response_code,t=o.token}return[s,t]}catch{}}async function W(s){const o=(await(await fetch(`${S}/api_token.php?command=reset&token=${s}`)).json()).response_code;return console.log(o),o}async function X(s){console.log("GetUsers: ",s);let t=null;return await fetch(`${L}/trivia?username=${s}`).then(e=>e.json()).then(e=>{if(e.length===0)t=null;else for(const o of e)console.log("For-loop GetUser: ",o.username),o.username===s&&(o.score!==void 0&&delete o.score,console.log("users: ",o),t=o,console.log(t))}).catch(e=>{console.log(e)}),t}async function Y(s){let t;return await fetch(`${L}/trivia`,{method:"POST",headers:{"X-API-Key":H,"Content-Type":"application/json"},body:JSON.stringify({username:s,highScore:0})}).then(e=>{if(!e.ok)throw new Error("Could not create new user");return e.json()}).then(e=>{console.log(e),t=e}).catch(e=>{t=null}),t}async function Z(s,t){let e;return console.log("Score to be patched: ",t,"User: ",s),await fetch(`${L}/trivia/${s}`,{method:"PATCH",headers:{"X-API-Key":H,"Content-Type":"application/json"},body:JSON.stringify({highScore:t})}).then(o=>{if(!o.ok)throw new Error("Could not update high score");return o.json()}).then(o=>{console.log("Updated user retrieved: ",o),e=o}).catch(o=>{console.log(o.message)}),e}const z=()=>{const s=localStorage.getItem("user");return s?JSON.parse(s):null};var ee=N({state:{results:[],user:z(),categories:[],questions:[],token:null},getters:{user:s=>s.user},mutations:{setUser:(s,t)=>{s.user=t,localStorage.setItem("user",JSON.stringify(t))},setCategories:(s,t)=>{s.categories=t},setQuestions:(s,t)=>{s.questions=t},addResult:(s,t)=>{s.results.push(t)},setToken:(s,t)=>{s.token=t},clearResults:s=>{s.results=[]}},actions:{async getUsers({},{userName:s}){const t=await X(s);return t===null?null:(localStorage.setItem("user",JSON.stringify(t)),t)},async createUser({commit:s},{userName:t}){const e=await Y(t);return e!==null?(s("setUser",e),null):"Creating new user failed, try again!"},async fetchCategories({commit:s}){const[t,e]=await J();if(e!==null)return e;s("setCategories",t),localStorage.setItem("categories",JSON.stringify(t))},async fetchQuestions({commit:s,state:t},{category:e,quantityVal:o,difficultyVal:n}){const[r,c]=await j(e,o,n,t.token);if(r===0)return s("setQuestions",c),0;if(r===4){const[g,h]=await j(e,o,n,null);return g===1?1:4}else return r},async fetchToken({commit:s}){try{const[t,e]=await K();if(e===""||e===void 0||t!==0)throw new Error("Unforeseen token-error!");s("setToken",e),localStorage.setItem("token",e);return}catch(t){return t.message}},async updateScore({commit:s,state:t},e){const o=e;console.log("Score in store",o);const n=await Z(t.user.id,o);return console.log("Score after fetch",e),console.log(n),n.id===t.user.id?(s("setUser",n),!0):!1},async resetToken({commit:s,state:t}){const e=await W(t.token);return console.log("Token code ",e),e}}}),te=(s,t)=>{const e=s.__vccOpts||s;for(const[o,n]of t)e[o]=n;return e};const se={};function oe(s,t){const e=B("router-view");return m(),$(e)}var ne=te(se,[["render",oe]]);const re=a("label",{for:"username"},"Username",-1),ae={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-2"},le={emits:["onAuthSuccess"],setup(s,{emit:t}){const e=b(),o=p(""),n=p(""),r=l=>{t("onAuthSuccess")},c=l=>{n.value=l},g=async()=>{const l=o.value,i=await e.dispatch("getUsers",{userName:l});if(i!==null){c(i.username+" already exists!");return}else if(i===null){const u=await e.dispatch("createUser",{userName:l});if(t("onAuthSuccess"),u!==null){c(u);return}}},h=async()=>{const l=o.value,i=await e.dispatch("getUsers",{userName:l});if(i!==null)e.commit("setUser",i),r();else if(i===null){c("You have to register first");return}};return(l,i)=>(m(),_(w,null,[a("form",null,[a("fieldset",null,[re,T(a("input",{id:"username",class:"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",type:"text",placeholder:"E.g..john.doe@email.com","onUpdate:modelValue":i[0]||(i[0]=u=>o.value=u)},null,512),[[M,o.value]])]),a("button",{onClick:g,type:"button"},"Register"),a("button",{onClick:h,type:"button"},"Login")]),n.value?(m(),_("div",ae,[a("p",null,y(n.value),1)])):k("",!0)],64))}},ce={setup(s){const t=x(),e=()=>{t.push("/Selection")};return(o,n)=>(m(),_("main",null,[I(le,{onOnAuthSuccess:e})]))}},ue={props:{question:{type:Object,required:!0}},emits:["gameCompletedSuccessful"],setup(s,{emit:t}){const e=s,o=h=>{t("gameCompletedSuccessful",h)};function n(h){return h.sort(()=>Math.random()-.5)}const r=[e.question.correct_answer,e.question.incorrect_answers[0]];n(r);const c=p(r[0]),g=p(r[1]);return(h,l)=>(m(),_(w,null,[a("button",{type:"button",onClick:l[0]||(l[0]=i=>o(c.value)),class:"bg-emerald-400 text-white p-2 rounded mx-4"},y(c.value),1),a("button",{type:"button",onClick:l[1]||(l[1]=i=>o(g.value)),class:"bg-emerald-400 text-white p-2 rounded mx-4"},y(g.value),1)],64))}},ie=["innerHTML"],de=["innerHTML"],pe=["innerHTML"],fe=["innerHTML"],he={props:{question:{type:Object,required:!0}},emits:["gameCompletedSuccessful"],setup(s,{emit:t}){const e=s,o=i=>{t("gameCompletedSuccessful",i)};function n(i){return i.sort(()=>Math.random()-.5)}const r=[e.question.correct_answer,e.question.incorrect_answers[0],e.question.incorrect_answers[1],e.question.incorrect_answers[2]];n(r);const c=p(r[0]),g=p(r[1]),h=p(r[2]),l=p(r[3]);return(i,u)=>(m(),_(w,null,[a("button",{innerHTML:c.value,type:"button",onClick:u[0]||(u[0]=f=>o(c.value)),class:"bg-emerald-400 text-white p-2 rounded mx-2"},null,8,ie),a("button",{innerHTML:g.value,type:"button",onClick:u[1]||(u[1]=f=>o(g.value)),class:"bg-emerald-400 text-white p-2 rounded mx-2"},null,8,de),a("button",{innerHTML:h.value,type:"button",onClick:u[2]||(u[2]=f=>o(h.value)),class:"bg-emerald-400 text-white p-2 rounded mx-2"},null,8,pe),a("button",{innerHTML:l.value,type:"button",onClick:u[3]||(u[3]=f=>o(l.value)),class:"bg-emerald-400 text-white p-2 rounded mx-2"},null,8,fe)],64))}},me={class:"container mx-auto px-10 mt-10"},ge=["innerHTML"],_e={setup(s){const t=b(),e=x(),o=C(()=>t.state.questions),n=p(0),r=p(o.value[n.value]),c=p(r.value.type),g=p(r.value.question),h=p(1),l=p(1),i=()=>{e.push("/results")},u=f=>{const d={question:r.value.question,user_answer:f,correct_answer:r.value.correct_answer};t.commit("addResult",d),n.value++,o.value.length===n.value?i():(r.value=o.value[n.value],c.value=r.value.type,g.value=r.value.question,h.value++,l.value++)};return(f,d)=>(m(),_("main",me,[a("h1",{class:"mb-5 text-2xl font-semibold",innerHTML:g.value},null,8,ge),c.value==="boolean"?(m(),$(ue,{onGameCompletedSuccessful:u,question:r.value,key:h.value},null,8,["question"])):k("",!0),c.value==="multiple"?(m(),$(he,{onGameCompletedSuccessful:u,question:r.value,key:l.value},null,8,["question"])):k("",!0)]))}},ve={class:"mb-3"},ye=a("label",{for:"select-category","aria-label":"Select-Category",class:"block"},"Select Category",-1),we=a("option",{disabled:"",value:""},"Please select category",-1),be=["value"],ke={class:"mb-3"},Se=a("label",{for:"quantity","aria-label":"Quantity",class:"block"},"Choose an amount of questions, max 50",-1),$e={key:0,class:"bg-red-500 text-white p-3"},Te=a("span",{class:"block text-lg mb-3"},"Error",-1),qe={class:"mb-3"},xe=a("label",{for:"difficulty","aria-label":"Difficulty",class:"block"},"Select Difficulty",-1),Ce=a("option",{disabled:"",value:""},"Please select difficulty",-1),Ae=a("option",{value:"easy"},"Easy",-1),Le=a("option",{value:"medium"},"Medium",-1),Re=a("option",{value:"hard"},"Hard",-1),Ue=[Ce,Ae,Le,Re],Me={key:0,class:"bg-red-500 text-white p-3"},Ie=a("span",{class:"block text-lg mb-3"},"Error",-1),Oe={emits:["startGameSuccessful"],setup(s,{emit:t}){const e=b(),o=C(()=>e.state.categories),n=async()=>{if(i()){const u=r.value,f=parseInt(c.value),d=g.value;let v=1;for(;v!==0;)if(v=await e.dispatch("fetchQuestions",{category:u,quantityVal:f,difficultyVal:d}),v===1){l.value="ERROR: Too many questions, try reducing amount of questions or change one of the other settings.";return}else if(v===2){l.value="ERROR: Developers fucked up, request sent was invalid.";return}else v===3?(console.log("Token invalid."),await e.dispatch("fetchToken")):v===4?(console.log("Token reset required."),await e.dispatch("resetToken")!==0&&(console.log("Token reset -> fetch new."),await e.dispatch("fetchToken"))):v!==0&&(console.log(v),l.value="ERROR: We don't even know what the hell happened!");localStorage.setItem("question-settings",JSON.stringify({category:u,amount:f,difficulty:d})),t("startGameSuccessful")}},r=p(""),c=p(""),g=p(""),h=p(""),l=p(""),i=()=>Object.is(parseInt(c.value),NaN)?(h.value="Must be a number, duh!",!1):parseInt(c.value)>50?(h.value="There can not be more than 50 questions! Reduce your number!",!1):(h.value="",!0);return(u,f)=>(m(),_(w,null,[a("form",{onSubmit:f[4]||(f[4]=G((...d)=>u.onSubmit&&u.onSubmit(...d),["prevent"])),class:"mb-3"},[a("fieldset",ve,[ye,T(a("select",{"onUpdate:modelValue":f[0]||(f[0]=d=>r.value=d),id:"select-category",class:"border border-slate-300"},[we,(m(!0),_(w,null,E(q(o),d=>(m(),_("option",{key:d.id,value:d.id},y(d.name),9,be))),128))],512),[[O,r.value]])]),a("fieldset",ke,[Se,T(a("input",{type:"tel",id:"quantity",placeholder:"How many questions?",class:"border border-slate-300","onUpdate:modelValue":f[1]||(f[1]=d=>c.value=d),onChange:i},null,544),[[M,c.value]])]),h.value?(m(),_("div",$e,[Te,a("p",null,y(h.value),1)])):k("",!0),a("fieldset",qe,[xe,T(a("select",{"onUpdate:modelValue":f[2]||(f[2]=d=>g.value=d),class:"border border-slate-300",id:"difficulty"},Ue,512),[[O,g.value]])]),a("div",null,[a("button",{onClick:f[3]||(f[3]=d=>n()),type:"button",class:"bg-green-500 text-white p-3 rounded"},"Start game!")])],32),l.value?(m(),_("div",Me,[Ie,a("p",null,y(l.value),1)])):k("",!0)],64))}},Ee={class:"container mx-auto px-4"},He=a("h1",{class:"mb-3 text-2xl"},"Let's get a game of Trivia going!",-1),je={setup(s){const t=x(),e=b();F(async()=>{await e.dispatch("fetchCategories"),localStorage.getItem("token")===null?await e.dispatch("fetchToken"):(e.commit("setToken",localStorage.getItem("token")),console.log(e.state.token),console.log(localStorage.getItem("token")))});const o=()=>{t.push("/questions")};return(n,r)=>(m(),_("main",Ee,[He,I(Oe,{onStartGameSuccessful:o})]))}},Ne={class:"mb-10"},Be=A("Question: "),Ge=["innerHTML"],Fe=A(" Correct answer: "),Qe=["innerHTML"],Pe=A(" User answer: "),De=["innerHTML"],Ve={props:{result:{type:Object,required:!0}},setup(s){const t=s;b();const e=p(t.result.question),o=p(t.result.correct_answer),n=p(t.result.user_answer);return(r,c)=>(m(),_("li",Ne,[a("span",null,[Be,a("span",{innerHTML:e.value},null,8,Ge)]),a("span",null,[Fe,a("span",{innerHTML:o.value},null,8,Qe)]),a("span",null,[Pe,a("span",{innerHTML:n.value},null,8,De)])]))}},Je={key:0},Ke={setup(s){const t=b(),e=p(0),o=()=>{e.value*=0,t.commit("clearResults"),U.push("/questions")},n=t.state.user.highScore,r=C(()=>t.state.results);(async()=>{for(const l of r.value)l.correct_answer===l.user_answer&&(e.value+=10);if(e.value>n){console.log("Score before final",e.value);const l=e.value;if(console.log("Final score: ",l),!await t.dispatch("updateScore",l))throw new Error("Failed to update user score!")}})();const g=async()=>{const l=JSON.parse(localStorage.getItem("question-settings"));console.log(l);const i=l.category,u=l.amount,f=l.difficulty;let d=1;for(;d!==0;)d=await t.dispatch("fetchQuestions",{category:i,quantityVal:u,difficultyVal:f}),d===3?(console.log("Token invalid."),await t.dispatch("fetchToken")):d===4&&(console.log("Token reset required."),await t.dispatch("resetToken")!==0&&(console.log("Token reset -> fetch new."),await t.dispatch("fetchToken")));o()},h=()=>{localStorage.removeItem("question-settings"),e.value*=0,t.commit("clearResults"),U.push("/selection")};return(l,i)=>(m(),_(w,null,[a("ul",null,[(m(!0),_(w,null,E(q(r),u=>(m(),$(Ve,{key:u.question,result:u},null,8,["result"]))),128))]),a("div",null,"Current highscore: "+y(q(n)),1),a("div",null,"Total score from game session: "+y(e.value),1),e.value>q(n)?(m(),_("div",Je,"New highscore achieved! Highscore will be updated!")):k("",!0),a("button",{class:"bg-emerald-400 text-white p-2 rounded mx-2",onClick:g},"Replay"),a("span",null,[a("button",{class:"bg-emerald-400 text-white p-2 rounded mx-2",onClick:h},"Back to selection")])],64))}},R=(s,t,e)=>{localStorage.getItem("user")?e():e("/")},We=(s,t,e)=>{localStorage.getItem("user")?e("/selection"):e()},Xe=[{path:"/",component:ce,beforeEnter:We},{path:"/selection",component:je,beforeEnter:R},{path:"/questions",component:_e,beforeEnter:R},{path:"/results",component:Ke,beforeEnter:R}];var U=Q({history:P(),routes:Xe});D(ne).use(ee).use(U).mount("#app");
